@CHARA_BUY
#DIM LRESULT

CALL CHARA_LIST

SIF RESULT == 10000
	RETURN 0

LRESULT = RESULT

IF RESULT == 0
	RETURN 0
ELSE
	RESTART
ENDIF

;2017/07/11に、表示～選択までの全てを関数内で行うように
@CHARA_LIST, ARG
#DIM DYNAMIC LCOUNT
#DIM DYNAMIC 次ページあり
#DIM DYNAMIC 計算用キャラ数
#DIM DYNAMIC 表示キャラ数
次ページあり = 0
計算用キャラ数 = 0
VARSET LOCAL, 0
;ARG
;1 = その他とりあえず全キャラ羅列するためのキャラリスト
;2 = PFREEで主人を選択する際のキャラリスト

SIF VARLINE
	CLEARLINE LINECOUNT-VARLINE
VARLINE = LINECOUNT
DRAWLINE

FOR LCOUNT, 0, 10000
	SIF !EXISTCSV(LCOUNT)
		CONTINUE

	IF 表示キャラ数 >= 30
		次ページあり = 1
		表示キャラ数 = 0
		BREAK
	ENDIF

	計算用キャラ数++
	SIF 計算用キャラ数 <= (TFLAG:ページ数*30)
		CONTINUE

	PRINTFORMLC [{LCOUNT, 4}] %CSVNAMEF(LCOUNT)%

	表示キャラ数++
NEXT

PRINTL 

DRAWLINE

PRINTPLAINFORM 　PAGE.{TFLAG:ページ数+1}　
IF TFLAG:ページ数 > 0
	PRINTLC [10001] 前のページ
ELSE
	PRINTLC  
ENDIF
PRINTPLAIN  
SIF 次ページあり
	PRINTC [10009] 後のページ
PRINTL 

DO
	INPUT
	SELECTCASE RESULT
		CASE 10001
			SIF TFLAG:ページ数
				TFLAG:ページ数--
		CASE 10009
			SIF 次ページあり
				TFLAG:ページ数++
		CASEELSE
			IF EXISTCSV(RESULT)
				VARLINE = 0
				DRAWLINE
				RETURN RESULT
			ENDIF
	ENDSELECT
LOOP LOOPRES(10001, 10009)

RESTART

