@PRECIPITATION
#DIM DYNAMIC F1
	;1ミリ以上になる日数
#DIM DYNAMIC F10
	;10ミリ以上になる日数
#DIM DYNAMIC P_A
	;関数F(X)のパラメータA
#DIM DYNAMIC P_B
	;関数F(X)のパラメータB
#DIM DYNAMIC R_MM, 51
	;R_MM:Xで雨量Xミリ以上になる確率(パーセント)

;降水量を算出する関数

;次のような流れで導き出す
;降水量Xミリ以上になる確率(パーセント)を算出する関数F(X)をパラメータA,Bを用いて、
;F(X) = AX + B  (X>0) とおく
;ただし、例外としてF(0)=100とする(降水量0ミリ以上になる確率は100パーセント)
;一般に F(1)>F(10) なのでAは負の値をとるため、Xを大きくするとF(X)はマイナスになってしまうが、
;IF分岐の挙動から問題ない
;この関数をおいたあと、気象庁から東京の1981年～2010年の1日ごとの
;1ミリ以上になる日数(X=1のときのF(1)の値)と10ミリ以上になる日数(X=10のときのF(10)の値)を取得する
;例えば1月1日は1ミリ以上になる日数が0.12日なので、12パーセントの確率で1ミリ以上になると考える
;平面座標(X,F(X))における2点を定めると関数F(X)は一意に定まる(パラメータA,Bの値が確定する)
;次の連立方程式でA,Bの値を求める
;	F(1)  =   A + B …①
;	F(10) = 10A + B …②
;(②－①)÷9よりAの値を求める
;Aの値を出したら、①より
;	B = F(1) - A

;雨量のサンプルを取得して代入
CALL TOKYO_STYLE_RAINY_DAY
F1 = RESULT
F10 = RESULT:1

;はじめにAの値を1000倍で求める
P_A = 1000 * (F10 - F1) /9

;Aの値を用いてBの値を1000倍で求める
P_B = 1000*F1 - P_A

;パラメータA,B(変数P_A,P_B)が求まったので具体的に計算
;F(X) = (P_A*X + P_B) / 1000
;パラメータA,Bが1000倍になっているので、最後に1000で割る
FOR COUNT, 1, 51
	R_MM:COUNT = (P_A * COUNT + P_B)/1000
NEXT

;R_MM:1～R_MM:50の値が揃ったのであとはその分布に従い雨量を出す

LOCAL = 1 + RAND:100

FOR COUNT, 1, 52
	IF COUNT == 51
		FLAG:降水量 = 50
	ELSEIF LOCAL > R_MM:COUNT
		FLAG:降水量 = COUNT-1
		BREAK
	ENDIF
NEXT


@TOKYO_STYLE_RAINY_DAY
;気象庁から東京の1981年～2010年の1日ごとの、1ミリ以上になる日数と10ミリ以上になる日数を取得する関数
;1日に対するパーセンテージで取得するため0.12日は12として扱う

;1ミリ以上になる日数の計算
SELECTCASE MONTH
	CASE 1
		SELECTCASE DAYS
			CASE 1, 2
				LOCAL = 12
			CASE 3, 4
				LOCAL = 13
			CASE 5 TO 7
				LOCAL = 14
			CASE 8 TO 15
				LOCAL = 15
			CASE 16 TO 19
				LOCAL = 16
			CASE 20, 21
				LOCAL = 17
			CASE 22 TO 25
				LOCAL = 16
			CASE 26 TO 28
				LOCAL = 15
			CASE 29 TO 31
				LOCAL = 14
		ENDSELECT
	CASE 2
		SELECTCASE DAYS
			CASE 1, 2
				LOCAL = 14
			CASE 3 TO 5
				LOCAL = 15
			CASE 6 TO 8
				LOCAL = 16
			CASE 9, 10
				LOCAL = 17
			CASE 11, 12
				LOCAL = 18
			CASE 13, 14
				LOCAL = 19
			CASE 15, 16
				LOCAL = 20
			CASE 17, 18
				LOCAL = 21
			CASE 19
				LOCAL = 22
			CASE 20, 21
				LOCAL = 23
			CASE 22, 23
				LOCAL = 24
			CASE 24, 25
				LOCAL = 25
			CASE 26 TO 29
				LOCAL = 26
		ENDSELECT
	CASE 3
		SELECTCASE DAYS
			CASE 1
				LOCAL = 26
			CASE 2 TO 9
				LOCAL = 27
			CASE 10, 11
				LOCAL = 28
			CASE 12, 13
				LOCAL = 29
			CASE 14
				LOCAL = 30
			CASE 15
				LOCAL = 31
			CASE 16, 17
				LOCAL = 32
			CASE 18
				LOCAL = 33
			CASE 19, 20
				LOCAL = 34
			CASE 21 TO 27
				LOCAL = 35
			CASE 28 TO 30
				LOCAL = 34
			CASE 31
				LOCAL = 33
		ENDSELECT
	CASE 4
		SELECTCASE DAYS
			CASE 1 TO 6
				LOCAL = 33
			CASE 7 TO 9
				LOCAL = 34
			CASE 10 TO 18
				LOCAL = 35
			CASE 19 TO 21
				LOCAL = 34
			CASE 22 TO 24
				LOCAL = 33
			CASE 25, 26
				LOCAL = 32
			CASE 27, 28
				LOCAL = 31
			CASE 29, 30
				LOCAL = 30
		ENDSELECT
	CASE 5
		SELECTCASE DAYS
			CASE 1 TO 6
				LOCAL = 30
			CASE 7, 8
				LOCAL = 31
			CASE 9
				LOCAL = 32
			CASE 10
				LOCAL = 33
			CASE 11, 12
				LOCAL = 34
			CASE 13 TO 22
				LOCAL = 35
			CASE 23 TO 25
				LOCAL = 34
			CASE 26, 27
				LOCAL = 33
			CASE 28
				LOCAL = 32
			CASE 29
				LOCAL = 31
			CASE 30, 31
				LOCAL = 30
		ENDSELECT
	CASE 6
		SELECTCASE DAYS
			CASE 1 TO 4
				LOCAL = 29
			CASE 5
				LOCAL = 30
			CASE 6
				LOCAL = 31
			CASE 7
				LOCAL = 32
			CASE 8
				LOCAL = 33
			CASE 9
				LOCAL = 34
			CASE 10
				LOCAL = 35
			CASE 11
				LOCAL = 36
			CASE 12
				LOCAL = 37
			CASE 13
				LOCAL = 38
			CASE 14, 15
				LOCAL = 39
			CASE 16
				LOCAL = 40
			CASE 17, 18
				LOCAL = 41
			CASE 19
				LOCAL = 42
			CASE 20, 21
				LOCAL = 43
			CASE 22, 23
				LOCAL = 44
			CASE 24 TO 28
				LOCAL = 45
			CASE 29, 30
				LOCAL = 44
		ENDSELECT
	CASE 7
		SELECTCASE DAYS
			CASE 1
				LOCAL = 43
			CASE 2
				LOCAL = 42
			CASE 3
				LOCAL = 41
			CASE 4
				LOCAL = 40
			CASE 5
				LOCAL = 39
			CASE 6
				LOCAL = 38
			CASE 7, 8
				LOCAL = 37
			CASE 9, 10
				LOCAL = 36
			CASE 11 TO 14
				LOCAL = 35
			CASE 15, 16
				LOCAL = 34
			CASE 17, 18
				LOCAL = 33
			CASE 19, 20
				LOCAL = 32
			CASE 21
				LOCAL = 31
			CASE 22, 23
				LOCAL = 30
			CASE 24
				LOCAL = 29
			CASE 25, 26
				LOCAL = 28
			CASE 27
				LOCAL = 27
			CASE 28, 29
				LOCAL = 26
			CASE 30, 31
				LOCAL = 25
		ENDSELECT
	CASE 8
		SELECTCASE DAYS
			CASE 1
				LOCAL = 25
			CASE 2 TO 7
				LOCAL = 24
			CASE 8 TO 10
				LOCAL = 25
			CASE 11 TO 20
				LOCAL = 24
			CASE 21 TO 23
				LOCAL = 25
			CASE 24 TO 27
				LOCAL = 26
			CASE 28 TO 31
				LOCAL = 27
		ENDSELECT
	CASE 9
		SELECTCASE DAYS
			CASE 1, 2
				LOCAL = 28
			CASE 3
				LOCAL = 29
			CASE 4
				LOCAL = 30
			CASE 5
				LOCAL = 31
			CASE 6
				LOCAL = 32
			CASE 7
				LOCAL = 33
			CASE 8
				LOCAL = 34
			CASE 9
				LOCAL = 35
			CASE 10
				LOCAL = 36
			CASE 11
				LOCAL = 37
			CASE 12
				LOCAL = 38
			CASE 13 TO 15
				LOCAL = 39
			CASE 16 TO 19
				LOCAL = 40
			CASE 20, 21
				LOCAL = 41
			CASE 22 TO 27
				LOCAL = 40
			CASE 28 TO 30
				LOCAL = 39
		ENDSELECT
	CASE 10
		SELECTCASE DAYS
			CASE 1 TO 5
				LOCAL = 38
			CASE 6 TO 8
				LOCAL = 37
			CASE 9, 10
				LOCAL = 36
			CASE 11
				LOCAL = 35
			CASE 12
				LOCAL = 34
			CASE 13
				LOCAL = 33
			CASE 14, 15
				LOCAL = 32
			CASE 16, 17
				LOCAL = 31
			CASE 18, 19
				LOCAL = 30
			CASE 20 TO 23
				LOCAL = 29
			CASE 24, 25
				LOCAL = 28
			CASE 26
				LOCAL = 27
			CASE 27, 28
				LOCAL = 26
			CASE 29, 30
				LOCAL = 25
			CASE 31
				LOCAL = 24
		ENDSELECT
	CASE 11
		SELECTCASE DAYS
			CASE 1 TO 6
				LOCAL = 24
			CASE 7 TO 11
				LOCAL = 25
			CASE 12 TO 14
				LOCAL = 24
			CASE 15 TO 17
				LOCAL = 23
			CASE 18, 19
				LOCAL = 22
			CASE 20 TO 23
				LOCAL = 21
			CASE 24 TO 27
				LOCAL = 20
			CASE 28 TO 30
				LOCAL = 19
		ENDSELECT
	CASE 12
		SELECTCASE DAYS
			CASE 1
				LOCAL = 19
			CASE 2 TO 4
				LOCAL = 18
			CASE 5 TO 7
				LOCAL = 17
			CASE 8 TO 10
				LOCAL = 16
			CASE 11 TO 13
				LOCAL = 15
			CASE 14, 15
				LOCAL = 14
			CASE 16 TO 18
				LOCAL = 13
			CASE 19 TO 21
				LOCAL = 12
			CASE 22 TO 30
				LOCAL = 11
			CASE 31
				LOCAL = 12
		ENDSELECT
ENDSELECT
;10ミリ以上になる日数の計算
SELECTCASE MONTH
	CASE 1
		SELECTCASE DAYS
			CASE 1 TO 7
				LOCAL:1 = 5
			CASE 8 TO 15
				LOCAL:1 = 6
			CASE 16 TO 25
				LOCAL:1 = 7
			CASE 26 TO 30
				LOCAL:1 = 6
			CASE 31
				LOCAL:1 = 5
		ENDSELECT
	CASE 2
		SELECTCASE DAYS
			CASE 1 TO 3
				LOCAL:1 = 5
			CASE 4 TO 8
				LOCAL:1 = 4
			CASE 9 TO 11
				LOCAL:1 = 5
			CASE 12
				LOCAL:1 = 6
			CASE 13, 14
				LOCAL:1 = 7
			CASE 15, 16
				LOCAL:1 = 8
			CASE 17, 18
				LOCAL:1 = 9
			CASE 19 TO 29
				LOCAL:1 = 10
		ENDSELECT
	CASE 3
		SELECTCASE DAYS
			CASE 1 TO 7
				LOCAL:1 = 10
			CASE 8 TO 10
				LOCAL:1 = 11
			CASE 11 TO 13
				LOCAL:1 = 12
			CASE 14 TO 16
				LOCAL:1 = 13
			CASE 17 TO 21
				LOCAL:1 = 14
			CASE 22 TO 25
				LOCAL:1 = 15
			CASE 26 TO 31
				LOCAL:1 = 16
		ENDSELECT
	CASE 4
		SELECTCASE DAYS
			CASE 1 TO 5
				LOCAL:1 = 16
			CASE 6 TO 10
				LOCAL:1 = 15
			CASE 11 TO 22
				LOCAL:1 = 14
			CASE 23, 24
				LOCAL:1 = 13
			CASE 25 TO 27
				LOCAL:1 = 12
			CASE 28 TO 30
				LOCAL:1 = 11
		ENDSELECT
	CASE 5
		SELECTCASE DAYS
			CASE 1 TO 3
				LOCAL:1 = 11
			CASE 4, 5
				LOCAL:1 = 12
			CASE 6, 7
				LOCAL:1 = 13
			CASE 8, 9
				LOCAL:1 = 14
			CASE 10, 11
				LOCAL:1 = 15
			CASE 12, 13
				LOCAL:1 = 16
			CASE 14 TO 23
				LOCAL:1 = 17
			CASE 24 TO 28
				LOCAL:1 = 16
			CASE 29 TO 31
				LOCAL:1 = 15
		ENDSELECT
	CASE 6
		SELECTCASE DAYS
			CASE 1 TO 4
				LOCAL:1 = 14
			CASE 5, 6
				LOCAL:1 = 15
			CASE 7, 8
				LOCAL:1 = 16
			CASE 9
				LOCAL:1 = 17
			CASE 10, 11
				LOCAL:1 = 18
			CASE 12, 13
				LOCAL:1 = 19
			CASE 14 TO 29
				LOCAL:1 = 20
			CASE 31
				LOCAL:1 = 19
		ENDSELECT
	CASE 7
		SELECTCASE DAYS
			CASE 1, 2
				LOCAL:1 = 19
			CASE 3, 4
				LOCAL:1 = 18
			CASE 5, 6
				LOCAL:1 = 17
			CASE 7, 8
				LOCAL:1 = 16
			CASE 9
				LOCAL:1 = 15
			CASE 10, 11
				LOCAL:1 = 14
			CASE 12 TO 14
				LOCAL:1 = 13
			CASE 15 TO 30
				LOCAL:1 = 12
			CASE 31
				LOCAL:1 = 11
		ENDSELECT
	CASE 8
		SELECTCASE DAYS
			CASE 1 TO 6
				LOCAL:1 = 11
			CASE 7 TO 18
				LOCAL:1 = 12
			CASE 19 TO 24
				LOCAL:1 = 11
			CASE 25 TO 28
				LOCAL:1 = 12
			CASE 29, 30
				LOCAL:1 = 13
			CASE 31
				LOCAL:1 = 14
		ENDSELECT
	CASE 9
		SELECTCASE DAYS
			CASE 1, 2
				LOCAL:1 = 14
			CASE 3, 4
				LOCAL:1 = 15
			CASE 5
				LOCAL:1 = 16
			CASE 6, 7
				LOCAL:1 = 17
			CASE 8 TO 10
				LOCAL:1 = 18
			CASE 11 TO 23
				LOCAL:1 = 19
			CASE 24 TO 30
				LOCAL:1 = 20
		ENDSELECT
	CASE 10
		SELECTCASE DAYS
			CASE 1 TO 4
				LOCAL:1 = 20
			CASE 5, 6
				LOCAL:1 = 21
			CASE 7 TO 10
				LOCAL:1 = 20
			CASE 11, 12
				LOCAL:1 = 19
			CASE 13
				LOCAL:1 = 18
			CASE 14 TO 15
				LOCAL:1 = 17
			CASE 16 TO 17
				LOCAL:1 = 16
			CASE 18 TO 20
				LOCAL:1 = 15
			CASE 21 TO 23
				LOCAL:1 = 14
			CASE 24, 25
				LOCAL:1 = 13
			CASE 26 TO 28
				LOCAL:1 = 12
			CASE 29 TO 31
				LOCAL:1 = 11
		ENDSELECT
	CASE 11
		SELECTCASE DAYS
			CASE 1 TO 7
				LOCAL:1 = 10
			CASE 8 TO 12
				LOCAL:1 = 9
			CASE 13 TO 30
				LOCAL:1 = 8
		ENDSELECT
	CASE 12
		SELECTCASE DAYS
			CASE 1, 2
				LOCAL:1 = 8
			CASE 2 TO 7
				LOCAL:1 = 7
			CASE 8 TO 11
				LOCAL:1 = 6
			CASE 12 TO 17
				LOCAL:1 = 5
			CASE 18 TO 30
				LOCAL:1 = 4
			CASE 31
				LOCAL:1 = 5
		ENDSELECT
ENDSELECT

RETURN LOCAL, LOCAL:1

