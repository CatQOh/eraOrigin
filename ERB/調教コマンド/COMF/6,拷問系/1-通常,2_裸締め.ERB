;-------------------------------------------------
;裸締め
;-------------------------------------------------
@USERCOM_ABLE_裸締め, ARG
#FUNCTION
;サドじゃないとできない
SIF !TALENT:PLAYER:サド
	RETURNF 0

COMRESULT = 1
RETURNF 1

@COM_裸締め
PRINTL 裸締め
CALL KOJO_MESSAGE_COM

;-------------------------------------------------
;ソース追加処理
;-------------------------------------------------
;消費体力、気力
LOSEBASE:体力 += 100
LOSEBASE:気力 += 350
SOURCE:苦痛 = 500
SOURCE:恐怖 = 1200
SOURCE:中毒 = 50
SOURCE:液体 = 20
SOURCE:屈従 = 200
SOURCE:逸脱 = 300
SOURCE:反感 = 1000

;-------------------------------------------------
;特殊ソース処理
;-------------------------------------------------
;苦痛のパラメータによる苦痛のソース増加は先に処理しておく
SOURCE:苦痛 += GETPALAMLV(PALAM:苦痛, 4)*(SOURCE:苦痛/2)

;-------------------------------------------------
;経験の処理
;-------------------------------------------------
CALL EXPUP, 1, 4

PRINTL 緊縛経験+1
EXP:緊縛経験 += 1

;依存度補正値(服従で1、隷属で2）
IF TALENT:服従 && PLAYER == MASTER
	TFLAG:依存度補正 += 1
ELSEIF TALENT:隷属 && PLAYER == MASTER
	TFLAG:依存度補正 += 2
ENDIF

;-------------------------------------------------
;絶頂チェック
;-------------------------------------------------
CALL SOURCE_CHECK_CVAB

;-------------------------------------------------
;射精チェック
;-------------------------------------------------
CALL SAMEN_CHECK_T, 0

CALL SAMEN_SHOOT_T, 0, NOWEX:射精

;-------------------------------------------------
;確率で気絶処理
;-------------------------------------------------
LOCAL = BASE:体力/100
SIF BASE:気力 > 0
	LOCAL *= 2

IF RAND:LOCAL == 0
	CALL SOURCE_CHECK
	PRINTW ………………
	PRINTW …………
	PRINTW ……
	PRINTFORMW 裸締めにより%CALLNAME:TARGET%は気絶しました
	;気絶フラグ
	TFLAG:気絶 = 1
	BEGIN AFTERTRAIN
ENDIF

RETURN 1

